var vscreen=document.getElementsByClassName("phone_screen")[0];var mousex,mousey;var ifdrag=false;var winwidth=320;var winheight=486;var thisobj=null;var pictag=0;var pagecnt=1;var editbefore=1;var editingpage=1;var animationid=0;window.onload=function(){localStorage.clear();animationid=0;document.getElementById("text").onclick=creatTextarea;document.getElementById("picture").onclick=function(){pictag=1;picmanager()};document.getElementById("background").onclick=function(){pictag=2;picmanager()};document.getElementById("music").onclick=musicmanage;document.addEventListener("input",changeValue);document.getElementById("save").onclick=saveeditarea;document.getElementById("grid").onclick=gridornot;document.getElementById("preview").onclick=previewcode;document.getElementById("preview").onmouseout=function(){document.getElementById("qrcode").style.display="none"};document.getElementById("cancelbg").onclick=function(){vscreen.style.background="";document.getElementById("success").style.opacity=1;setTimeout(function(){document.getElementById("success").style.opacity=0},800)};document.getElementById("cancelmusic").onclick=function(){localStorage.setItem("music","");alert("已取消音乐！")};document.getElementById("backmyh5").onclick=function(){window.location.href="/myh5"};document.getElementById("logout").onclick=logoutfunc;pagelistListener();var e=getParas();saverender();datainit();musicinit()};function logoutfunc(){$.ajax({url:"/edit/logout",type:"POST",dataType:"JSON",data:{},success:function(e){if(e.code==200){window.location.href="/"}}})}function selectAniname(e){var t=0;var n=document.getElementById("animations").childNodes;for(t=0;t<n.length;t++){if(e.parentNode.parentNode.parentNode.id===n[t].id){break}}var o=animatesplit();var i=o[t].split(" ");if(i.length==5){i[0]=e.value}else if(i.length==6){i[1]=e.value}var a=i.join(" ");o[t]=a;a=o.join(",");thisobj.style.animation=a;thisobj.style["-webkit-animation"]=a}function selectstyle(e){var t=0;var n=document.getElementById("animations").childNodes;for(t=0;t<n.length;t++){if(e.parentNode.parentNode.parentNode.id==n[t].id){break}}var o=animatesplit();var i=o[t].split(" ");if(i.length==5){i[2]=e.value}else if(i.length==6){i[3]=e.value}var a=i.join(" ");o[t]=a;a=o.join(",");thisobj.style.animation=a;thisobj.style["-webkit-animation"]=a}function infinitechange(e){var t=0;var n=document.getElementById("animations").childNodes;for(t=0;t<n.length;t++){if(e.parentNode.parentNode.parentNode.id==n[t].id){break}}var o=animatesplit();var i=o[t].split(" ");if(e.checked){if(i.length==5){i[4]="infinite"}else if(i.length==6){i[5]="infinite"}e.previousSibling.disabled=true}else{e.previousSibling.disabled=false;if(i.length==5){i[4]=e.previousSibling.value}else if(i.length==6){i[5]=e.previousSibling.value}}var a=i.join(" ");o[t]=a;a=o.join(",");thisobj.style.animation=a;thisobj.style["-webkit-animation"]=a}function changeValue(e){var e=e||window.event;var t=e.target;switch(t.id){case"bg-color":{thisobj.style["background-color"]=t.value;t.previousSibling.style["background-color"]=t.value;break}case"font-color":{thisobj.style["color"]=t.value;t.previousSibling.style["background-color"]=t.value;break}case"font-size1":{thisobj.style["font-size"]=t.value+"px";t.nextSibling.value=t.value;break}case"font-size2":{thisobj.style["font-size"]=t.value+"px";t.previousSibling.value=t.value;break}case"opacity1":{thisobj.style["opacity"]=parseFloat(t.value);t.nextSibling.value=parseFloat(t.value);break}case"opacity2":{thisobj.style["opacity"]=parseFloat(t.value);t.previousSibling.value=parseFloat(t.value);break}case"opacity3":{thisobj.style["opacity"]=parseFloat(t.value);t.nextSibling.value=parseFloat(t.value);break}case"opacity4":{thisobj.style["opacity"]=parseFloat(t.value);t.previousSibling.value=parseFloat(t.value);break}case"padding1":{thisobj.style["padding"]=t.value+"px";t.nextSibling.value=t.value;break}case"padding2":{thisobj.style["padding"]=t.value+"px";t.previousSibling.value=t.value;break}case"line-height1":{thisobj.style["line-height"]=t.value;t.nextSibling.value=t.value;break}case"line-height2":{thisobj.style["line-height"]=t.value;t.previousSibling.value=t.value;break}case"width1":{thisobj.style["width"]=t.value+"px";t.nextSibling.value=t.value;break}case"width2":{thisobj.style["width"]=t.value+"px";t.previousSibling.value=t.value;break}case"height1":{thisobj.style["height"]=t.value+"px";t.nextSibling.value=t.value;break}case"height2":{thisobj.style["height"]=t.value+"px";t.previousSibling.value=t.value;break}case"picwidth1":{thisobj.style["width"]=t.value+"px";t.nextSibling.value=t.value;break}case"picwidth2":{thisobj.style["width"]=t.value+"px";t.previousSibling.value=t.value;break}case"picheight1":{thisobj.style["height"]=t.value+"px";t.nextSibling.value=t.value;break}case"picheight2":{thisobj.style["height"]=t.value+"px";t.previousSibling.value=t.value;break}case"zindex1":{thisobj.style["z-index"]=t.value;t.previousSibling.value=t.value;break}case"zindex2":{thisobj.style["z-index"]=t.value;t.nextSibling.value=t.value;break}case"zindex3":{thisobj.style["z-index"]=t.value;t.nextSibling.value=t.value;break}case"zindex4":{thisobj.style["z-index"]=t.value;t.previousSibling.value=t.value;break}case"text-content":{thisobj.innerHTML=t.value;break}case"covertitle":{document.getElementsByClassName("phone_title")[0].innerHTML=document.getElementById("covertitle").value;break}default:{}}switch(t.className){case"a_duration":{var n=0;var o=document.getElementById("animations").childNodes;for(n=0;n<o.length;n++){if(t.parentNode.parentNode.parentNode.id==o[n].id){break}}var i=animatesplit();var a=i[n].split(" ");if(a.length==5){a[1]=t.value+"s"}else if(a.length==6){a[2]=t.value+"s"}var l=a.join(" ");i[n]=l;l=i.join(",");thisobj.style.animation=l;thisobj.style["-webkit-animation"]=l;if(t.previousSibling.className=="a_duration"){t.previousSibling.value=t.value}else if(t.nextSibling.className=="a_duration"){t.nextSibling.value=t.value}break}case"a_delay":{var n=0;var o=document.getElementById("animations").childNodes;for(n=0;n<o.length;n++){if(t.parentNode.parentNode.parentNode.id==o[n].id){break}}var i=animatesplit();var a=i[n].split(" ");if(a.length==5){a[3]=t.value+"s"}else if(a.length==6){a[4]=t.value+"s"}var l=a.join(" ");i[n]=l;l=i.join(",");thisobj.style.animation=l;thisobj.style["-webkit-animation"]=l;if(t.previousSibling.className=="a_delay"){t.previousSibling.value=t.value}else if(t.nextSibling.className="a_delay"){t.nextSibling.value=t.value}break}case"a_time":{var n=0;var o=document.getElementById("animations").childNodes;for(n=0;n<o.length;n++){if(t.parentNode.parentNode.parentNode.id==o[n].id){break}}var i=animatesplit();var a=i[n].split(" ");if(a.length==5){a[4]=t.value}else if(a.length==6){a[5]=t.value}var l=a.join(" ");i[n]=l;l=i.join(",");thisobj.style.animation=l;thisobj.style["-webkit-animation"]=l;break}}}function removeAnimate(e){var t=window.event;t.preventDefault();mousex=t.clientX;mousey=t.clientY;console.log(e);var n=document.getElementById("delemenu");n.style.display="block";n.style.left=mousex+"px";n.style.top=mousey+"px";document.onclick=document.getElementById("animations").onclick=function(){n.style.display="none"};n.onclick=function(){var t=0;var o=document.getElementById("animations").childNodes;for(t=0;t<o.length;t++){if(e.parentNode.id==o[t].id){break}}var i=animatesplit();i.splice(t,1);var a=i.join(",");thisobj.style.animation=a;thisobj.style["-webkit-animation"]=a;document.getElementById("animations").removeChild(e.parentNode);n.style.display="none"}}function addAnimation(e){var e=e||window.event;e.stopPropagation();var t=document.createElement("li");animationid++;t.innerHTML="<div class='anititle' oncontextmenu='removeAnimate(this);'>动画"+"</div>"+aniselect;t.id=animationid;document.getElementById("animations").appendChild(t);var n=thisobj.style.animation;if(n.length>0){n=n+",novalue 0s linear 0s 1";thisobj.style.animation=n;thisobj.style["-webkit-animation"]=n}else{n=n+"novalue 0s linear 0s 1";thisobj.style.animation=n;thisobj.style["-webkit-animation"]=n}}function animatesplit(){var e=thisobj.style.animation;var t=e.split(",");return t}function previewcode(e){var e=e||window.event;var t=document.getElementById("qrcode");t.style.display="block";var n=getParas();var o="http://yourip:3000/show?"+n["work"];jQuery("#qrcode").html("");jQuery("#qrcode").qrcode({render:"canvas",text:o,width:150,height:150});document.getElementById("qrcode").style.left=e.target.offsetLeft+20+"px";document.getElementById("qrcode").style.top=e.target.offsetTop+30+"px"}function musicmanage(){document.getElementsByClassName("mask")[0].style.display="block";document.getElementsByClassName("musicmanage")[0].style.display="block";document.getElementsByClassName("mask")[0].onclick=document.getElementById("picclose2").onclick=function(){document.getElementsByClassName("mask")[0].style.display="none";document.getElementsByClassName("musicmanage")[0].style.display="none"};document.getElementById("uploadmusic").onchange=uploadMusic}function deletethispage(e){var t=t||window.event;t.preventDefault();thisobj=this;mousex=t.clientX;mousey=t.clientY;var n=document.getElementsByClassName("pages")[0];var o=document.getElementById("delemenu");o.style.display="block";o.style.left=mousex+"px";o.style.top=mousey+"px";document.onclick=function(){o.style.display="none"};o.onclick=function(){if(document.getElementById(e).previousSibling){editbefore=e;editingpage=document.getElementById(e).previousSibling.id;editthispage(editingpage);n.removeChild(document.getElementById(e));localStorage.removeItem(e);o.style.display="none"}else if(document.getElementById(e).nextSibling){editbefore=e;editingpage=document.getElementById(e).nextSibling.id;editthispage(editingpage);n.removeChild(document.getElementById(e));localStorage.removeItem(e);o.style.display="none"}else{alert("至少保留一个页面！");o.style.display="none"}localStorage.setItem("pagelist",document.getElementById("pldivcontent").innerHTML)}}function editthispage(e,t){var n=document.getElementsByClassName("pages")[0];for(var o=0;o<n.childNodes.length;o++){n.childNodes[o].className=""}document.getElementById(e).className="editinglist";editingpage=e;if(localStorage.getItem(editbefore)&&!t){var i=localStorage.getItem(editbefore);var a=JSON.parse(i);a.background=vscreen.style["background-image"];a.content=vscreen.innerHTML;localStorage.setItem(editbefore,JSON.stringify(a))}vscreen.innerHTML=JSON.parse(localStorage.getItem(e)).content;vscreen.style["background-image"]=JSON.parse(localStorage.getItem(e)).background;editbefore=e;var l=vscreen.childNodes;for(var o=0;o<l.length;o++){if(l[o].className=="textdiv"){l[o].onmousedown=dragbegin;l[o].onmousemove=draging;l[o].onmouseup=dragend;l[o].onmouseout=function(){ifdrag=false};l[o].oncontextmenu=contextdelete;l[o].addEventListener("click",clickPerformed)}else if(l[o].className=="picimg"){l[o].onmousedown=dragbegin;l[o].onmousemove=draging;l[o].onmouseup=dragend;l[o].onmouseout=function(){ifdrag=false};l[o].oncontextmenu=contextdelete;l[o].addEventListener("click",clickPerformed)}}}function datainit(){var e=getParas();$.ajax({url:"edit/init",type:"POST",dataType:"JSON",data:{work:e["work"]},success:function(e){if(e.code==200){var t="";for(var n=0;n<e.info.length;n++){t+="<div><img onclick=creatPicarea("+"'"+e.info[n].urlname+"'"+') src="'+e.info[n].urlname+'" id="'+e.info[n]._id+'"><span onclick=delelibpic('+"'"+e.info[n]._id+"'"+")>删除</span></div>"}document.getElementsByClassName("picarea")[0].innerHTML=t}},error:{}})}function pagelistListener(){var e=document.getElementsByClassName("pagelist")[0].getElementsByTagName("div");var t=document.getElementById("pldivcontent");var n=getParas();e[0].onclick=function(n){var n=n||window.event;n.preventDefault();if(e[1].className=="pldiv pageli"){}else{localStorage.setItem("pagelist",t.innerHTML);e[1].className="pldiv pageli";t.innerHTML=localStorage.getItem("cover-title")}};e[1].onclick=function(n){var n=n||window.event;n.preventDefault();if(e[1].className=="pldiv"){}else{localStorage.setItem("cover-title",t.innerHTML);e[1].className="pldiv";t.innerHTML=localStorage.getItem("pagelist")}};e[2].onclick=function(e){var e=e||window.event;e.preventDefault();document.getElementsByClassName("pagelist")[0].getElementsByTagName("div")[1].className="pldiv";var n=localStorage.getItem("pagelist");t.innerHTML=n;var o=document.getElementsByClassName("pages")[0].innerHTML;pagecnt++;o+='<li id="'+pagecnt+'" onclick="editthispage(this.id);" oncontextmenu="deletethispage(this.id)">第 '+pagecnt+" 页</li>";document.getElementsByClassName("pages")[0].innerHTML=o;localStorage.setItem("pagelist",t.innerHTML);var i={background:"",content:""};var a=JSON.stringify(i);localStorage.setItem(pagecnt,a)}}function saveeditarea(){editbefore=editingpage;document.getElementById("pldivcontent").innerHTML=localStorage.getItem("pagelist");editthispage(editbefore);document.getElementsByClassName("pagelist")[0].getElementsByTagName("div")[1].className="pldiv pageli";document.getElementById("pldivcontent").innerHTML=localStorage.getItem("cover-title");var e=document.getElementsByClassName("phone_title")[0].innerHTML;var t=document.getElementById("pldivcontent").getElementsByTagName("img")[0].getAttribute("src");var n=[];var o=0;for(var i=1;i<=pagecnt;i++){if(localStorage.getItem(i)){n.push(JSON.parse(localStorage.getItem(i)));o++}}$.ajax({url:"/edit/save",dataType:"JSON",type:"POST",data:{title:e,cover:t,pages:o,editinfo:JSON.stringify(n),music:localStorage.getItem("music")},success:function(e){if(e.code==200){window.location="/edit?user="+e.user+"&work="+e.work}},error:function(e,t,n){console.log("XMLHttpRequest.readyState"+e.readyState);console.log("XMLHttpRequest.status"+e.status);console.log("XMLHttpRequest.responseText"+e.responseText)}})}function saverender(){var e=getParas();$.ajax({url:"/edit/render",dataType:"JSON",type:"POST",data:{todo:"render",userid:e["user"],worktype:e["work"]},success:function(e){if(e.code==200){var t=document.getElementsByClassName("useroption")[0];var n='<li id="backmyh5">我的H5</li><li id="logout">退出账号：'+e.user+"</li>";t.innerHTML=n;document.getElementById("backmyh5").onclick=function(){window.location.href="/myh5"};document.getElementById("logout").onclick=logoutfunc;var o=document.getElementById("pldivcontent");document.getElementsByClassName("phone_title")[0].innerHTML=e.info.title;o.innerHTML='<span>标题</span></br><input type="text" id="covertitle" value="'+e.info.title+'"></br></br><span>封面</span></br><img id="cover" src="'+e.info.cover+'" style="width:250px;height:250px;"/></br><a href="javascript:;" onclick="pictag=3;picmanager();">更改封面</a>';localStorage.setItem("cover-title",o.innerHTML);var i='<ul class="pages">';pagecnt=e.info.page;var a=JSON.parse(e.info.content);for(var l=1;l<=e.info.page;l++){(function(){var e=l;var t=l-1;i+='<li id="'+e+'" onclick="editthispage(this.id);" oncontextmenu="deletethispage(this.id)">第 '+e+" 页</li>";var n={background:a[t].background,content:a[t].content};var o=JSON.stringify(n);localStorage.setItem(e,o)})(l)}i+="</ul>;";localStorage.setItem("pagelist",i);o.innerHTML=localStorage.getItem("pagelist");editbefore=1;editingpage=1;editthispage(editingpage,true);localStorage.setItem("pagelist",o.innerHTML);o.innerHTML=localStorage.getItem("cover-title");localStorage.setItem("music",e.info.music)}},error:function(){}})}function clickPerformed(e){var e=e||window.event;thisobj=this;var t=e.target;switch(t.className){case"textdiv":{e.stopPropagation();document.getElementById("picedit").style.display="none";var n=document.getElementById("textedit");document.getElementsByClassName("editchoices")[0].style.display="block";var o=document.getElementsByClassName("outlook")[0].getElementsByTagName("li");o[1].className="";document.getElementById("aniedit").style.display="none";document.getElementById("textedit").style.display="block";o[0].className="outlooksele";o[0].onclick=function(e){var e=e||window.event;e.stopPropagation();o[0].className="outlooksele";o[1].className="";document.getElementById("aniedit").style.display="none";document.getElementById("textedit").style.display="block"};o[1].onclick=function(e){var e=e||window.event;e.stopPropagation();o[1].className="outlooksele";o[0].className="";document.getElementById("textedit").style.display="none";document.getElementById("aniedit").style.display="block";document.getElementById("addani").onclick=addAnimation;document.getElementById("aniedit").onclick=function(e){var e=e||window.event;e.stopPropagation()}};document.getElementById("bg-color").value=thisobj.style["background-color"];document.getElementById("bg-color").previousSibling.style["background-color"]=thisobj.style["background-color"];document.getElementById("font-color").value=thisobj.style["color"];document.getElementById("font-color").previousSibling.style["background-color"]=thisobj.style["color"];document.getElementById("font-size1").value=parseInt(thisobj.style["font-size"]);document.getElementById("font-size1").nextSibling.value=parseInt(thisobj.style["font-size"]);document.getElementById("opacity1").value=thisobj.style.opacity;document.getElementById("opacity1").nextSibling.value=parseFloat(thisobj.style["opacity"]);document.getElementById("padding1").value=parseInt(thisobj.style["padding"]);document.getElementById("padding1").nextSibling.value=parseInt(thisobj.style["padding"]);document.getElementById("zindex1").value=parseInt(thisobj.style["z-index"]);document.getElementById("zindex1").nextSibling.value=parseInt(thisobj.style["z-index"]);document.getElementById("line-height1").value=parseInt(thisobj.style["line-height"]);document.getElementById("line-height1").nextSibling.value=parseInt(thisobj.style["line-height"]);document.getElementById("text-content").value=thisobj.innerHTML;var i=animatesplit();document.getElementById("animations").innerHTML="";for(var a=0;a<i.length;a++){if(i[a]=="")break;var l=i[a].split(" ");if(l.length==6){l.splice(0,1)}var s=document.createElement("li");animationid++;var u="<div class='anititle' oncontextmenu='removeAnimate(this);'>动画"+"</div>"+'<ul><li style-attr="ani-name"><span>动画名称</span><select onchange="selectAniname(this);" value="'+l[0]+'"><option value="novalue">novalue | 无效果</option><option value="flash">flash | 闪烁</option><option value="shake">shake | 摇动</option><option value="bounce">bounce | 弹性</option><option value="wiggle">wiggle | 扭动</option><option value="tada">tada | 弹加摇动</option><option value="swing">swing | 摇摆(小)</option><option value="wobble">wobble | 摇晃(大)</option><option value="pulse">pulse | 脉冲放大</option><option value="flip">flip</option> 兼容性有问题<option value="rollIn">rollIn | 滚入</option><option value="lightSpeedIn">lightSpeedIn | 惯性出现</option><option value="flipInX">flipInX | X轴翻滚出现</option><option value="flipInY">flipInY | Y轴翻滚出现</option><option value="fadeIn">fadeIn | 淡入</option><option value="fadeInUp">fadeInUp | 向上淡入</option><option value="fadeInDown">fadeInDown | 向下淡入</option><option value="fadeInLeft">fadeInLeft | 从左淡入</option><option value="fadeInRight">fadeInRight | 从右淡入</option><option value="fadeInUpBig">fadeInUpBig | 向上淡入（大幅度）</option><option value="fadeInDownBig">fadeInDownBig | 向下淡入(大幅度)</option><option value="fadeInLeftBig">fadeInLeftBig | 从左淡入(大幅度)</option><option value="fadeInRightBig">fadeInRightBig | 从右淡入(大幅度)</option><option value="bounceIn">bounceIn | 弹入</option><option value="bounceInUp">bounceInUp | 向上弹出</option><option value="bounceInDown">bounceInDown | 从下弹出</option><option value="bounceInLeft">bounceInLeft | 从左弹出</option><option value="bounceInRight">bounceInRight | 从右弹出</option><option value="rotateIn">rotateIn | 旋转出现</option><option value="rotateInUpLeft">rotateInUpLeft | 向上转出（左）</option><option value="rotateInDownLeft">rotateInDownLeft | 向下转出（左）</option><option value="rotateInUpRight">rotateInUpRight | 向上转出（右）</option><option value="rotateInDownRight">rotateInDownRight | 向下转出（右）</option><option value="rollOut">rollOut | 滚出</option><option value="hinge">hinge | 悬挂掉出</option><option value="lightSpeedOut">lightSpeedOut | 惯性消失</option><option value="flipOutX">flipOutX | X轴翻滚消失</option><option value="flipOutY">flipOutY | Y轴翻滚消失</option><option value="fadeOut">fadeOut | 淡出</option><option value="fadeOutUp">fadeOutUp | 向上淡出</option><option value="fadeOutDown">fadeOutDown | 向下淡出</option><option value="fadeOutLeft">fadeOutLeft | 向左淡出</option><option value="fadeOutRight">fadeOutRight | 向右淡出</option><option value="fadeOutUpBig">fadeOutUpBig | 向上淡出（大幅度）</option><option value="fadeOutDownBig">fadeOutDownBig | 向下淡出（大幅度）</option><option value="fadeOutLeftBig">fadeOutLeftBig | 向左淡出（大幅度）</option><option value="fadeOutRightBig">fadeOutRightBig | 向右淡出（大幅度）</option><option value="bounceOut">bounceOut | 弹出后消失</option><option value="bounceOutUp">bounceOutUp | 向上弹出</option><option value="bounceOutDown">bounceOutDown | 向下弹出</option><option value="bounceOutLeft">bounceOutLeft | 向左弹出</option><option value="bounceOutRight">bounceOutRight | 向右弹出</option><option value="rotateOut">rotateOut | 旋转消失</option><option value="rotateOutUpLeft">rotateOutUpLeft | 向上转出（左）</option><option value="rotateOutDownLeft">rotateOutDownLeft | 向下转出（左）</option><option value="rotateOutUpRight">rotateOutUpRight | 向上转出（右）</option><option value="rotateOutDownRight">rotateOutDownRight | 向下转出（右）</option></select></li><li style-attr="ani-duration"><span>动画时长</span><input class="a_duration" type="range" min="0" max="10" step="0.1" value="'+parseFloat(l[1])+'"><input class="a_duration" type="number" min="0" max="10" step="0.1" value="'+parseFloat(l[1])+'"></li><li style-attr="ani-tween"><span>动画曲线</span><select onchange="selectstyle(this);" value="'+l[2]+'"><option value="ease">ease | 自然</option><option value="linear">linear | 匀速</option><option value="ease-in">ease-in | 加速</option><option value="ease-out">ease-out | 减速</option></select></li><li style-attr="ani-delay"><span>动画延时</span><input class="a_delay" type="range" min="0" max="50" step="0.1" value="'+parseFloat(l[3])+'"><input class="a_delay" type="number" min="0" max="50" step="0.1" value="'+parseFloat(l[3])+'"></li>';if(l[4]=="infinite"){u+='<li style-attr="ani-count"><span>动画次数</span><input class="a_time" type="number" min="0" max="10" step="1" value="1" disabled="true"><input class="a_infinite" type="checkbox" style="margin-left: 15px;" checked="true" onclick="infinitechange(this)"><label for="infinite" style="margin-left: 8px;">循环</label></li></ul>'}else{u+='<li style-attr="ani-count"><span>动画次数</span><input class="a_time" type="number" min="0" max="10" step="1" value="'+l[4]+'" disabled="true"><input class="a_infinite" type="checkbox" style="margin-left: 15px;" checked="true" onclick="infinitechange(this)"><label for="infinite" style="margin-left: 8px;">循环</label></li></ul>'}s.innerHTML=u;s.id=animationid;document.getElementById("animations").appendChild(s)}n.onclick=function(e){e.stopPropagation()};document.onclick=function(){document.getElementsByClassName("editchoices")[0].style.display="none"};break}case"picimg":{e.stopPropagation();document.getElementById("textedit").style.display="none";var p=document.getElementById("picedit");document.getElementsByClassName("editchoices")[0].style.display="block";var o=document.getElementsByClassName("outlook")[0].getElementsByTagName("li");o[1].className="";document.getElementById("aniedit").style.display="none";document.getElementById("picedit").style.display="block";o[0].className="outlooksele";o[0].onclick=function(e){var e=e||window.event;e.stopPropagation();o[0].className="outlooksele";o[1].className="";document.getElementById("aniedit").style.display="none";document.getElementById("picedit").style.display="block"};o[1].onclick=function(e){var e=e||window.event;e.stopPropagation();o[1].className="outlooksele";o[0].className="";document.getElementById("picedit").style.display="none";document.getElementById("aniedit").style.display="block";document.getElementById("addani").onclick=addAnimation;document.getElementById("aniedit").onclick=function(e){var e=e||window.event;e.stopPropagation()}};document.getElementById("picwidth1").value=parseInt(thisobj.style.width);document.getElementById("picwidth1").nextSibling=parseInt(thisobj.style.width);document.getElementById("picheight1").value=parseInt(thisobj.style.height);document.getElementById("picheight1").nextSibling=parseInt(thisobj.style.height);document.getElementById("opacity3").value=thisobj.style.opacity;document.getElementById("opacity3").nextSibling.value=parseFloat(thisobj.style["opacity"]);document.getElementById("zindex3").value=parseInt(thisobj.style["z-index"]);document.getElementById("zindex3").nextSibling.value=parseInt(thisobj.style["z-index"]);var i=animatesplit();document.getElementById("animations").innerHTML="";for(var a=0;a<i.length;a++){if(i[a]=="")break;var l=i[a].split(" ");if(l.length==6){l.splice(0,1)}var s=document.createElement("li");animationid++;console.log(l[0]);var u="<div class='anititle' oncontextmenu='removeAnimate(this);'>动画"+"</div>"+'<ul><li style-attr="ani-name"><span>动画名称</span><select onchange="selectAniname(this);" value="'+l[0]+'"><option value="novalue">novalue | 无效果</option><option value="flash">flash | 闪烁</option><option value="shake">shake | 摇动</option><option value="bounce">bounce | 弹性</option><option value="wiggle">wiggle | 扭动</option><option value="tada">tada | 弹加摇动</option><option value="swing">swing | 摇摆(小)</option><option value="wobble">wobble | 摇晃(大)</option><option value="pulse">pulse | 脉冲放大</option><option value="flip">flip</option> 兼容性有问题<option value="rollIn">rollIn | 滚入</option><option value="lightSpeedIn">lightSpeedIn | 惯性出现</option><option value="flipInX">flipInX | X轴翻滚出现</option><option value="flipInY">flipInY | Y轴翻滚出现</option><option value="fadeIn">fadeIn | 淡入</option><option value="fadeInUp">fadeInUp | 向上淡入</option><option value="fadeInDown">fadeInDown | 向下淡入</option><option value="fadeInLeft">fadeInLeft | 从左淡入</option><option value="fadeInRight">fadeInRight | 从右淡入</option><option value="fadeInUpBig">fadeInUpBig | 向上淡入（大幅度）</option><option value="fadeInDownBig">fadeInDownBig | 向下淡入(大幅度)</option><option value="fadeInLeftBig">fadeInLeftBig | 从左淡入(大幅度)</option><option value="fadeInRightBig">fadeInRightBig | 从右淡入(大幅度)</option><option value="bounceIn">bounceIn | 弹入</option><option value="bounceInUp">bounceInUp | 向上弹出</option><option value="bounceInDown">bounceInDown | 从下弹出</option><option value="bounceInLeft">bounceInLeft | 从左弹出</option><option value="bounceInRight">bounceInRight | 从右弹出</option><option value="rotateIn">rotateIn | 旋转出现</option><option value="rotateInUpLeft">rotateInUpLeft | 向上转出（左）</option><option value="rotateInDownLeft">rotateInDownLeft | 向下转出（左）</option><option value="rotateInUpRight">rotateInUpRight | 向上转出（右）</option><option value="rotateInDownRight">rotateInDownRight | 向下转出（右）</option><option value="rollOut">rollOut | 滚出</option><option value="hinge">hinge | 悬挂掉出</option><option value="lightSpeedOut">lightSpeedOut | 惯性消失</option><option value="flipOutX">flipOutX | X轴翻滚消失</option><option value="flipOutY">flipOutY | Y轴翻滚消失</option><option value="fadeOut">fadeOut | 淡出</option><option value="fadeOutUp">fadeOutUp | 向上淡出</option><option value="fadeOutDown">fadeOutDown | 向下淡出</option><option value="fadeOutLeft">fadeOutLeft | 向左淡出</option><option value="fadeOutRight">fadeOutRight | 向右淡出</option><option value="fadeOutUpBig">fadeOutUpBig | 向上淡出（大幅度）</option><option value="fadeOutDownBig">fadeOutDownBig | 向下淡出（大幅度）</option><option value="fadeOutLeftBig">fadeOutLeftBig | 向左淡出（大幅度）</option><option value="fadeOutRightBig">fadeOutRightBig | 向右淡出（大幅度）</option><option value="bounceOut">bounceOut | 弹出后消失</option><option value="bounceOutUp">bounceOutUp | 向上弹出</option><option value="bounceOutDown">bounceOutDown | 向下弹出</option><option value="bounceOutLeft">bounceOutLeft | 向左弹出</option><option value="bounceOutRight">bounceOutRight | 向右弹出</option><option value="rotateOut">rotateOut | 旋转消失</option><option value="rotateOutUpLeft">rotateOutUpLeft | 向上转出（左）</option><option value="rotateOutDownLeft">rotateOutDownLeft | 向下转出（左）</option><option value="rotateOutUpRight">rotateOutUpRight | 向上转出（右）</option><option value="rotateOutDownRight">rotateOutDownRight | 向下转出（右）</option></select></li><li style-attr="ani-duration"><span>动画时长</span><input class="a_duration" type="range" min="0" max="10" step="0.1" value="'+parseFloat(l[1])+'"><input class="a_duration" type="number" min="0" max="10" step="0.1" value="'+parseFloat(l[1])+'"></li><li style-attr="ani-tween"><span>动画曲线</span><select onchange="selectstyle(this);" value="'+l[2]+'"><option value="ease">ease | 自然</option><option value="linear">linear | 匀速</option><option value="ease-in">ease-in | 加速</option><option value="ease-out">ease-out | 减速</option></select></li><li style-attr="ani-delay"><span>动画延时</span><input class="a_delay" type="range" min="0" max="50" step="0.1" value="'+parseFloat(l[3])+'"><input class="a_delay" type="number" min="0" max="50" step="0.1" value="'+parseFloat(l[3])+'"></li>';if(l[4]=="infinite"){u+='<li style-attr="ani-count"><span>动画次数</span><input class="a_time" type="number" min="0" max="10" step="1" value="1" disabled="true"><input class="a_infinite" type="checkbox" style="margin-left: 15px;" checked="true" onclick="infinitechange(this)"><label for="infinite" style="margin-left: 8px;">循环</label></li></ul>'}else{u+='<li style-attr="ani-count"><span>动画次数</span><input class="a_time" type="number" min="0" max="10" step="1" value="'+l[4]+'" disabled="true"><input class="a_infinite" type="checkbox" style="margin-left: 15px;" checked="true" onclick="infinitechange(this)"><label for="infinite" style="margin-left: 8px;">循环</label></li></ul>'}s.innerHTML=u;s.id=animationid;document.getElementById("animations").appendChild(s);var c=document.getElementById("animations").childNodes[a].getElementsByTagName("select");c[0].value=l[0];c[1].value=l[2]}p.onclick=function(e){e.stopPropagation()};document.onclick=function(){document.getElementsByClassName("editchoices")[0].style.display="none"};break}}}function creatPicarea(e){if(pictag==1){var t=document.createElement("img");t.className="picimg";vscreen.appendChild(t);t.src=e;t.style.position="absolute";t.style.top="0";t.style.width="100px";t.style.height="100px";t.style.left="0";t.style.display="block";t.style.padding="0";t.style["z-index"]="1";t.style.opacity="1";t.style.animation="";t.style["-webkit-animation"]="";t.onmousedown=dragbegin;t.onmousemove=draging;t.onmouseup=dragend;t.onmouseout=function(){ifdrag=false};t.oncontextmenu=contextdelete;t.addEventListener("click",clickPerformed);document.getElementsByClassName("mask")[0].style.display="none";document.getElementsByClassName("picmanage")[0].style.display="none"}else if(pictag==3){document.getElementById("cover").src=e;document.getElementsByClassName("mask")[0].style.display="none";document.getElementsByClassName("picmanage")[0].style.display="none";localStorage.setItem("cover-title",document.getElementById("pldivcontent").innerHTML)}else if(pictag==2){vscreen.style.background="url("+e+") no-repeat center";vscreen.style["background-size"]="cover";document.getElementsByClassName("mask")[0].style.display="none";document.getElementsByClassName("picmanage")[0].style.display="none"}}function creatTextarea(){var e=document.createElement("div");e.style.display="inline-block";e.style.width="100px";e.style.height="50px";e.style["box-sizing"]="border-box";e.style["background-color"]="rgba(0,0,0,0)";e.style.color="#1a1a1a";e.style["line-height"]="1.5";e.style.padding="5px";e.style["z-index"]="1";e.style.position="absolute";e.style.left=0;e.style.top=0;e.style["font-size"]="14px";e.style["word-break"]="break-all";e.style.overflow="hidden";e.style.opacity="1";e.style.animation="";e.style["-webkit-animation"]="";e.className="textdiv";e.innerHTML="文本";vscreen.appendChild(e);e.onmousedown=dragbegin;e.onmousemove=draging;e.onmouseup=dragend;e.onmouseout=function(){ifdrag=false};e.oncontextmenu=contextdelete;e.addEventListener("click",clickPerformed)}function contextdelete(e){
var e=e||window.event;e.preventDefault();thisobj=this;mousex=e.clientX;mousey=e.clientY;var t=document.getElementById("delemenu");t.style.display="block";t.style.left=mousex+"px";t.style.top=mousey+"px";document.onclick=function(){t.style.display="none";document.getElementsByClassName("editchoices")[0].style.display="none"};t.onclick=function(){vscreen.removeChild(thisobj);t.style.display="none";document.getElementsByClassName("editchoices")[0].style.display="none"}}function dragbegin(e){var e=e||window.event;e.preventDefault();mousex=e.clientX-this.offsetLeft;mousey=e.clientY-this.offsetTop;ifdrag=true}function draging(e){var e=e||window.event;e.preventDefault();var t=e.clientX;var n=e.clientY;var o=0;var i=0;if(ifdrag===true){o=t-mousex;i=n-mousey;o=o<0?0:o;i=i<0?0:i;var a=winwidth-this.offsetWidth;var l=winheight-this.offsetHeight;o=o>a?a:o;i=i>l?l:i;this.style.left=o+"px";this.style.top=i+"px";var s=parseFloat(this.style.top)/parseFloat(winheight);this.style.top=s*100+"%";var u=parseFloat(this.style.left)/parseFloat(winwidth);this.style.left=u*100+"%"}}function dragend(e){ifdrag=false}function getParas(){var e=location.search;var t=new Object;if(e.indexOf("?")!=-1){var n=e.substr(1);var o=n.split("&");for(var i=0;i<o.length;i++){t[o[i].split("=")[0]]=o[i].split("=")[1]}return t}}function gridornot(){var e=document.getElementsByClassName("phone_con")[0].getElementsByTagName("div")[1];if(e.className=="phone_screen grid_bg"){e.className="phone_screen"}else{e.className="phone_screen grid_bg"}}function uploadPic(){var e=new FormData;var t=$("#uploadpic")[0].files;if(t){e.append("file",t[0])}$.ajax({type:"POST",dataType:"JSON",url:"/edit/upload",data:e,contentType:false,processData:false,success:function(e){if(e.code==200){datainit();document.getElementById("success").style.opacity=1;setTimeout(function(){document.getElementById("success").style.opacity=0},800)}else{alert(e.errMsg)}},error:function(e,t,n){}})}function musicinit(){$.ajax({type:"POST",dataType:"JSON",url:"edit/musicinfo",data:{},success:function(e){var t='<ul class="musiclist">';for(var n=0;n<e.info.length;n++){t+='<li id="'+e.info[n].urlname+'" onclick="localStorage.setItem('+"'"+"music"+"'"+",this.id);alert("+"'"+"设置成功"+"'"+');">'+e.info[n].filename+"</li>"}t+="</ul>";document.getElementsByClassName("musicarea")[0].innerHTML=t},error:function(){}})}function uploadMusic(){var e=new FormData;var t=$("#uploadmusic")[0].files;if(t){e.append("file",t[0])}$.ajax({type:"POST",dataType:"JSON",url:"/edit/uploadmusic",data:e,contentType:false,processData:false,success:function(e){if(e.code==200){musicinit();document.getElementById("success").style.opacity=1;setTimeout(function(){document.getElementById("success").style.opacity=0},800)}else{alert(e.errMsg)}},error:function(e,t,n){}})}function delelibpic(e){$.ajax({url:"edit/delepic",type:"POST",dataType:"JSON",data:{picid:e},success:function(e){if(e.code==200){var t="";for(var n=0;n<e.info.length;n++){t+="<div><img onclick=creatPicarea("+"'"+e.info[n].urlname+"'"+') src="'+e.info[n].urlname+'" id="'+e.info[n]._id+'"><span onclick=delelibpic('+"'"+e.info[n]._id+"'"+")>删除</span></div>"}document.getElementsByClassName("picarea")[0].innerHTML=t}},error:function(){}})}function picmanager(){document.getElementsByClassName("mask")[0].style.display="block";document.getElementsByClassName("picmanage")[0].style.display="block";document.getElementsByClassName("mask")[0].onclick=document.getElementById("picclose").onclick=function(){document.getElementsByClassName("mask")[0].style.display="none";document.getElementsByClassName("picmanage")[0].style.display="none"};document.getElementById("uploadpic").onchange=uploadPic}var aniselect='<ul><li style-attr="ani-name"><span>动画名称</span><select onchange="selectAniname(this);" value="novalue"><option value="novalue">novalue | 无效果</option><option value="flash">flash | 闪烁</option><option value="shake">shake | 摇动</option><option value="bounce">bounce | 弹性</option><option value="wiggle">wiggle | 扭动</option><option value="tada">tada | 弹加摇动</option><option value="swing">swing | 摇摆(小)</option><option value="wobble">wobble | 摇晃(大)</option><option value="pulse">pulse | 脉冲放大</option><option value="flip">flip</option> 兼容性有问题<option value="rollIn">rollIn | 滚入</option><option value="lightSpeedIn">lightSpeedIn | 惯性出现</option><option value="flipInX">flipInX | X轴翻滚出现</option><option value="flipInY">flipInY | Y轴翻滚出现</option><option value="fadeIn">fadeIn | 淡入</option><option value="fadeInUp">fadeInUp | 向上淡入</option><option value="fadeInDown">fadeInDown | 向下淡入</option><option value="fadeInLeft">fadeInLeft | 从左淡入</option><option value="fadeInRight">fadeInRight | 从右淡入</option><option value="fadeInUpBig">fadeInUpBig | 向上淡入（大幅度）</option><option value="fadeInDownBig">fadeInDownBig | 向下淡入(大幅度)</option><option value="fadeInLeftBig">fadeInLeftBig | 从左淡入(大幅度)</option><option value="fadeInRightBig">fadeInRightBig | 从右淡入(大幅度)</option><option value="bounceIn">bounceIn | 弹入</option><option value="bounceInUp">bounceInUp | 向上弹出</option><option value="bounceInDown">bounceInDown | 从下弹出</option><option value="bounceInLeft">bounceInLeft | 从左弹出</option><option value="bounceInRight">bounceInRight | 从右弹出</option><option value="rotateIn">rotateIn | 旋转出现</option><option value="rotateInUpLeft">rotateInUpLeft | 向上转出（左）</option><option value="rotateInDownLeft">rotateInDownLeft | 向下转出（左）</option><option value="rotateInUpRight">rotateInUpRight | 向上转出（右）</option><option value="rotateInDownRight">rotateInDownRight | 向下转出（右）</option><option value="rollOut">rollOut | 滚出</option><option value="hinge">hinge | 悬挂掉出</option><option value="lightSpeedOut">lightSpeedOut | 惯性消失</option><option value="flipOutX">flipOutX | X轴翻滚消失</option><option value="flipOutY">flipOutY | Y轴翻滚消失</option><option value="fadeOut">fadeOut | 淡出</option><option value="fadeOutUp">fadeOutUp | 向上淡出</option><option value="fadeOutDown">fadeOutDown | 向下淡出</option><option value="fadeOutLeft">fadeOutLeft | 向左淡出</option><option value="fadeOutRight">fadeOutRight | 向右淡出</option><option value="fadeOutUpBig">fadeOutUpBig | 向上淡出（大幅度）</option><option value="fadeOutDownBig">fadeOutDownBig | 向下淡出（大幅度）</option><option value="fadeOutLeftBig">fadeOutLeftBig | 向左淡出（大幅度）</option><option value="fadeOutRightBig">fadeOutRightBig | 向右淡出（大幅度）</option><option value="bounceOut">bounceOut | 弹出后消失</option><option value="bounceOutUp">bounceOutUp | 向上弹出</option><option value="bounceOutDown">bounceOutDown | 向下弹出</option><option value="bounceOutLeft">bounceOutLeft | 向左弹出</option><option value="bounceOutRight">bounceOutRight | 向右弹出</option><option value="rotateOut">rotateOut | 旋转消失</option><option value="rotateOutUpLeft">rotateOutUpLeft | 向上转出（左）</option><option value="rotateOutDownLeft">rotateOutDownLeft | 向下转出（左）</option><option value="rotateOutUpRight">rotateOutUpRight | 向上转出（右）</option><option value="rotateOutDownRight">rotateOutDownRight | 向下转出（右）</option></select></li><li style-attr="ani-duration"><span>动画时长</span><input class="a_duration" type="range" min="0" max="10" step="0.1" value="0"><input class="a_duration" type="number" min="0" max="10" step="0.1" value="0"></li><li style-attr="ani-tween"><span>动画曲线</span><select onchange="selectstyle(this);" value="linear"><option value="ease">ease | 自然</option><option value="linear">linear | 匀速</option><option value="ease-in">ease-in | 加速</option><option value="ease-out">ease-out | 减速</option></select></li><li style-attr="ani-delay"><span>动画延时</span><input class="a_delay" type="range" min="0" max="50" step="0.1" value="0"><input class="a_delay" type="number" min="0" max="50" step="0.1" value="0"></li><li style-attr="ani-count"><span>动画次数</span><input class="a_time" type="number" min="0" max="10" step="1" value="1"><input class="a_infinite" type="checkbox" style="margin-left: 15px;" onclick="infinitechange(this)"><label for="infinite" style="margin-left: 8px;">循环</label></li></ul>';