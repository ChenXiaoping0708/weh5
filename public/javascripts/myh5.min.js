var pageid;window.onload=function(){pageid=1;document.getElementById("new").onclick=newh5;document.getElementById("qrcode").onmouseout=qrremove;loaddata(1)};function deleteelm(e){$.ajax({url:"/myh5",type:"POST",dataType:"JSON",data:{todo:"dele",workid:e},success:function(e){if(e.code==200){document.getElementById("success").style.opacity=1;setTimeout(function(){document.getElementById("success").style.opacity=0},800);pageid=1;loaddata(1)}},error:function(){}})}function qrremove(){document.getElementById("qrcode").innerHTML="";document.getElementById("qrcode").style.left=0+"px";document.getElementById("qrcode").style.top=60+"px"}function publishmyh5(e){$.ajax({url:"myh5/publishmyh5",type:"POST",dataType:"JSON",data:{workid:e},success:function(e){if(e.code==200){document.getElementById("success").style.opacity=1;setTimeout(function(){document.getElementById("success").style.opacity=0},800);loaddata(pageid)}}})}function recallmyh5(e){$.ajax({url:"myh5/recallmyh5",type:"POST",dataType:"JSON",data:{workid:e},success:function(e){if(e.code==200){document.getElementById("success").style.opacity=1;setTimeout(function(){document.getElementById("success").style.opacity=0},800);loaddata(pageid)}}})}function copymyh5(e){$.ajax({url:"myh5/copymyh5",type:"POST",dataType:"JSON",data:{workid:e},success:function(e){if(e.code==200){document.getElementById("success").style.opacity=1;setTimeout(function(){document.getElementById("success").style.opacity=0},800);pageid=1;loaddata(1)}}})}function loaddata(e){document.getElementById("qrcode").innerHTML="";pageid=e;$.ajax({url:"/myh5",type:"POST",dataType:"JSON",data:{todo:"load",page:e},success:function(e){var t=document.getElementById("mainbody");var o="";o+='<div id="new"></div>';for(var d=0;d<e.datainfo.length;d++){var i='<div class="h5-item"><img class="h5-cover" src="'+e.datainfo[d].cover+'" id="'+e.datainfo[d]._id+'"><p class="h5-title">'+e.datainfo[d].title+'</p><ul class="h5-editways"><li onclick="window.location='+"'/edit?user="+e.datainfo[d].owner+"&work="+e.datainfo[d]._id+"';"+'">编辑</li><li onclick="copymyh5('+"'"+e.datainfo[d]._id+"'"+');">复制</li><li onclick="deleteelm('+"'"+e.datainfo[d]._id+"'"+');">删除</li>';if(e.datainfo[d].draf==1){i+='<li onclick="publishmyh5('+"'"+e.datainfo[d]._id+"'"+')">发布</li></ul></div>'}else{i+='<li onclick="recallmyh5('+"'"+e.datainfo[d]._id+"'"+')">撤回</li></ul></div>'}o+=i}o+='<ul id="pages">';if(e.isfirst==true){o+=""}else{o+="<li onclick=loaddata(pageid-1)>上一页</li>"}o+="<li>第&nbsp;"+pageid+"&nbsp;页</li>";if(e.islast==true){o+=""}else{o+="<li onclick=loaddata(pageid+1)>下一页</li>"}o+="</ul>";t.innerHTML=o;document.getElementById("new").onclick=newh5;$(".h5-item").each(function(){$(this).mouseover(function(e){var t="http://yourip:3000/show?"+$(this).find("img").attr("id");jQuery("#qrcode").html("");jQuery("#qrcode").qrcode({render:"canvas",text:t,width:200,height:200});document.getElementById("qrcode").style.left=$(this).offset().left+"px";document.getElementById("qrcode").style.top=$(this).offset().top+"px"});$(this).find("img").mouseover(function(e){var t="http://yourip:3000/show?"+$(this).attr("id");jQuery("#qrcode").html("");document.getElementById("qrcode").style.left=0+"px";document.getElementById("qrcode").style.top=0+"px";jQuery("#qrcode").qrcode({render:"canvas",text:t,width:200,height:200});document.getElementById("qrcode").style.left=$(this).offset().left+"px";document.getElementById("qrcode").style.top=$(this).offset().top+"px"})})},error:function(){}})}function newh5(){$.ajax({url:"/myh5",dataType:"JSON",type:"POST",data:{todo:"goedit"},success:function(e){if(e.code==200){window.location="/edit?user="+e.userid+"&work="+e.workid}},error:function(){}})}