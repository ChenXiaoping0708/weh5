var starty,y,abovey;var pageid=0;var maxpage=0;$(document).ready(function(){abovey=document.body.scrollTop;var e=location.search;e=e.substring(1,25);document.addEventListener("touchstart",touchStartFun,false);document.addEventListener("touchmove",touchMoveFun,false);document.addEventListener("touchend",touchEndFun,false);$.ajax({url:"/show",type:"POST",dataType:"JSON",data:{todo:"show",workid:e},success:function(e){if(e.code==200){var t="";t+='<div class="music"><img src="/images/music_pointer.png"><img class="play" id="music" src="/images/music_disc.png"></div>';var a=JSON.parse(e.info.content);maxpage=e.info.page-1;for(var o=0;o<e.info.page;o++){(function(){var e=o;var n=a[e].content.split("");var c=[];var s=[];var i=0;var d=0;var u=0;for(;i<n.length;i++){var r=i-2;var l=i-1;var m=i-6;if(n[m]=="a"&&n[r]=="n"&&(n[l]=":")){while(n[i]!=";"){c[d++]=n[i++]}i--}if(d>0){for(var g=0;g<d;g++){s[u++]=c[g]}s[u++]=";";s[u++]="-";s[u++]="w";s[u++]="e";s[u++]="b";s[u++]="k";s[u++]="i";s[u++]="t";s[u++]="-";s[u++]="a";s[u++]="n";s[u++]="i";s[u++]="m";s[u++]="a";s[u++]="t";s[u++]="i";s[u++]="o";s[u++]="n";s[u++]=":";for(var g=0;g<d;g++){s[u++]=c[g]}d=0}else{s[u++]=n[i]}}var v=s.join("");t+='<div class="page" id="page'+e+'">'+v+"</div>"})(o)}t+='<audio autoplay="true"><source src="'+e.info.music+'" type="audio/mpeg"></audio>';$("body").html(t);var n=document.getElementById("music");var c=document.getElementsByTagName("audio")[0];document.getElementsByTagName("audio")[0].pause();document.getElementById("music").className="";for(var o=0;o<e.info.page;o++){var s="page"+o;document.getElementById(s).style["background-image"]=a[o].background}var i=parseFloat(document.body.clientWidth)/parseFloat(320);var d=parseFloat(document.body.clientHeight)/parseFloat(486);var u=i>d?d:i;$(".page *").each(function(){$(this).css("width",$(this).width()*i+"px")});$(".page *").each(function(){$(this).css("height",$(this).height()*d+"px");var e=parseInt($(this).css("font-size"));$(this).css("font-size",e*d+"px")});c.addEventListener("ended",musicEndFun,false);n.addEventListener("touchstart",musicStartFun,false)}},error:function(e,t,a){console.log("XMLHttpRequest.readyState"+e.readyState);console.log("XMLHttpRequest.status"+e.status);console.log("XMLHttpRequest.responseText"+e.responseText)}})});function touchStartFun(e){e.preventDefault();var t=e.touches[0];starty=t.clientY}function touchMoveFun(e){e.preventDefault()}function touchEndFun(e){e.preventDefault();var t=e.changedTouches[0];y=t.clientY-starty;var a=null;var o;if(y<-35){o=document.body.scrollTop;if(o===document.body.scrollHeight-document.body.clientHeight){}else{a=setInterval(function(){if(o>=abovey+document.body.clientHeight-50){document.body.scrollTop=document.body.clientHeight+abovey;abovey=document.body.clientHeight+abovey;clearInterval(a);pageid++;var e=document.getElementById("page"+pageid).innerHTML;document.getElementById("page"+pageid).innerHTML=e}else{o+=50;document.body.scrollTop=o}},30)}}if(y>35){o=document.body.scrollTop;if(o==0){}else{a=setInterval(function(){if(o<=abovey-document.body.clientHeight+50){document.body.scrollTop=abovey-document.body.clientHeight;abovey=abovey-document.body.clientHeight;clearInterval(a);pageid--;var e=document.getElementById("page"+pageid).innerHTML;document.getElementById("page"+pageid).innerHTML=e}else{o-=50;document.body.scrollTop=o}},30)}}}function musicEndFun(e){document.getElementById("music").setAttribute("class","")}function musicStartFun(e){e.preventDefault();console.log("hhhh");if(document.getElementsByTagName("audio")[0].paused){document.getElementsByTagName("audio")[0].play();document.getElementById("music").className="play"}else if(document.getElementsByTagName("audio")[0].play){document.getElementsByTagName("audio")[0].pause();document.getElementById("music").className=""}}