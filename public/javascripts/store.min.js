var pageid=1;window.onload=function(){getdata();document.getElementById("addmore").onclick=fetchdata};function useh5(e){$.ajax({url:"/store/useh5",dataType:"JSON",type:"POST",data:{workid:e},success:function(e){if(e.code==400){alert("请登录！")}else if(e.code==200){window.location="/edit?user="+e.userid+"&work="+e.workid}},error:function(e,t,o){console.log("XMLHttpRequest.readyState"+e.readyState);console.log("XMLHttpRequest.status"+e.status);console.log("XMLHttpRequest.responseText"+e.responseText)}})}function fetchdata(){$.ajax({url:"/store/fetch",dataType:"JSON",data:{pageid:pageid},type:"POST",success:function(e){if(e.code==200){var t=document.getElementsByClassName("container")[0];for(var o=0;o<e.count;o++){var a=document.createElement("div");a.className="item";var d='<div class="cover" style="background-image:url('+"'.."+e.doc[o].cover+"')"+'"></div><div class="options" id="'+e.doc[o]._id+'"><div class="opbtn useit" onclick=useh5(this.parentNode.id)>引用</div><div class="opbtn qrbtn">二维码</div></div><div class="title">'+e.doc[o].title+'</div><div class="author">作者:'+e.doc[o].ownername+"</div>";a.innerHTML=d;t.appendChild(a)}if(e.finish==1){document.getElementById("addmore").style.display="none"}pageid++;$(".item").each(function(){var e=$(this).find(".options").attr("id");var t=$(this);$(this).find(".qrbtn").click(function(o){var a="http://yourip:3000/show?"+e;jQuery("#qrcode").html("");jQuery("#qrcode").qrcode({render:"canvas",text:a,width:200,height:200});document.getElementById("qrcode").style.left=t.offset().left+"px";document.getElementById("qrcode").style.top=t.offset().top+"px"})})}},error:function(e,t,o){console.log("XMLHttpRequest.readyState"+e.readyState);console.log("XMLHttpRequest.status"+e.status);console.log("XMLHttpRequest.responseText"+e.responseText)}})}function getdata(){$.ajax({url:"/store/getdata",dataType:"JSON",type:"POST",data:{},success:function(e){if(e.code==200){fetchdata(1)}},error:function(){}})}